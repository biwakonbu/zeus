# 要件定義 - USECASE サブシステム分類機能

**バージョン**: 1.0
**公開日**: 2026-01-26

---

## 1. 概要

### 1.1 目的

Zeus プロジェクトの USECASE ビューにおいて、ユースケースが増加しても関係性を把握しやすくするため、サブシステム（Subsystem）による分類機能を導入する。

### 1.2 スコープ

- バックエンド: サブシステムエンティティ管理、CLI コマンド、API エンドポイント
- フロントエンド: サブシステム境界描画、カラースキーム、レイアウト対応

### 1.3 ユーザー要件

| 要件 | 内容 |
|------|------|
| R1 | サブシステムによる UseCase 分類が必須 |
| R2 | 後方互換性は考慮不要 |
| R3 | 視覚的明確さを最優先 |
| R4 | 将来拡張性を考慮 |
| R5 | UML 準拠 |

---

## 2. 機能要件

### 2.1 サブシステム管理 (FR-SUB)

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-SUB-001 | サブシステムの作成（ID 自動生成） | 必須 |
| FR-SUB-002 | サブシステムの一覧表示 | 必須 |
| FR-SUB-003 | サブシステムの詳細取得 | 必須 |
| FR-SUB-004 | サブシステムの更新 | 必須 |
| FR-SUB-005 | サブシステムの削除 | 必須 |
| FR-SUB-006 | サブシステム参照整合性チェック（警告レベル） | 必須 |

### 2.2 UseCase - サブシステム紐付け (FR-UC)

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-UC-001 | UseCase に subsystem_id フィールド追加（オプション） | 必須 |
| FR-UC-002 | UseCase 作成時に --subsystem オプションで指定可能 | 必須 |
| FR-UC-003 | UseCase 更新時に subsystem_id 変更可能 | 必須 |
| FR-UC-004 | 未指定 UseCase は「未分類」として扱う | 必須 |

### 2.3 CLI コマンド (FR-CLI)

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-CLI-001 | `zeus add subsystem <name>` コマンド | 必須 |
| FR-CLI-002 | `zeus list subsystems` コマンド | 必須 |
| FR-CLI-003 | `zeus add usecase --subsystem <id>` オプション | 必須 |

### 2.4 API エンドポイント (FR-API)

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-API-001 | `GET /api/subsystems` - サブシステム一覧 | 必須 |
| FR-API-002 | `GET /api/usecases` に subsystem_id を含める | 必須 |

### 2.5 ビジュアル表示 (FR-VIS)

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-VIS-001 | サブシステム境界を丸角矩形で描画 | 必須 |
| FR-VIS-002 | サブシステム名をタイトルバーに表示（左上配置） | 必須 |
| FR-VIS-003 | サブシステムごとに UseCase をグループ化 | 必須 |
| FR-VIS-004 | ハッシュベースの自動カラー生成 | 必須 |
| FR-VIS-005 | 未分類 UseCase 用の独立境界（グレー系） | 必須 |

---

## 3. 非機能要件

### 3.1 セキュリティ (NFR-SEC)

| ID | 要件 | 基準 |
|----|------|------|
| NFR-SEC-001 | サブシステム ID のバリデーション | ValidateID 関数使用 |
| NFR-SEC-002 | パストラバーサル防止 | ValidatePath 関数使用 |

### 3.2 パフォーマンス (NFR-PERF)

| ID | 要件 | 基準 |
|----|------|------|
| NFR-PERF-001 | サブシステム一覧取得 | < 100ms |
| NFR-PERF-002 | 境界描画（100 UseCase 以下） | < 500ms |

### 3.3 保守性 (NFR-MAINT)

| ID | 要件 | 基準 |
|----|------|------|
| NFR-MAINT-001 | EntityHandler パターン準拠 | 既存ハンドラーと一貫性 |
| NFR-MAINT-002 | テストカバレッジ | 80% 以上 |

---

## 4. データ要件

### 4.1 サブシステムエンティティ

| フィールド | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| id | string | Yes | `sub-xxxxxxxx` 形式 |
| name | string | Yes | サブシステム名 |
| description | string | No | 説明 |
| metadata.created_at | string | Yes | 作成日時 |
| metadata.updated_at | string | Yes | 更新日時 |

### 4.2 UseCase エンティティ（拡張）

| フィールド | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| subsystem_id | string | No | 所属サブシステム ID |

---

## 5. 制約条件

| ID | 制約 |
|----|------|
| C-001 | サブシステムは単一ファイル `subsystems.yaml` で管理 |
| C-002 | ID 形式は Zeus 標準（`sub-` プレフィックス + 8桁英数字） |
| C-003 | 参照整合性エラーは警告扱い（致命的エラーにしない） |
| C-004 | 未分類は特殊 ID `__uncategorized__` で表現 |

---

## 6. 関連ドキュメント

- [設計書](./design.md)
- [UML ユースケース機能仕様](../uml-usecase-feature/)
